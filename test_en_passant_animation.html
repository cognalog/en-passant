<!DOCTYPE html>
<html>
<head>
    <title>En-Passant Animation Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-case { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .code { background: #f5f5f5; padding: 10px; font-family: monospace; }
    </style>
</head>
<body>
    <h1>En-Passant Capture Animation Fix Test</h1>
    
    <div class="test-case">
        <h3>Test Case 1: White en-passant capture</h3>
        <p><strong>Setup:</strong> White pawn on e5, Black pawn moves from f7 to f5</p>
        <p><strong>Move:</strong> exf6 (en-passant capture)</p>
        <p><strong>Expected:</strong> Animation should capture the black pawn from f5, not f6</p>
        <div class="code">
            FEN before move: rnbqkbnr/ppp1p1pp/8/4Pp2/8/8/PPPP1PPP/RNBQKBNR w KQkq f6 0 3<br>
            From square: e5<br>
            To square: f6<br>
            Captured piece should be found at: f5 (not f6)
        </div>
    </div>
    
    <div class="test-case">
        <h3>Test Case 2: Black en-passant capture</h3>
        <p><strong>Setup:</strong> Black pawn on d4, White pawn moves from e2 to e4</p>
        <p><strong>Move:</strong> dxe3 (en-passant capture)</p>
        <p><strong>Expected:</strong> Animation should capture the white pawn from e4, not e3</p>
        <div class="code">
            FEN before move: rnbqkbnr/ppp1pppp/8/8/3pP3/8/PPPP1PPP/RNBQKBNR b KQkq e3 0 3<br>
            From square: d4<br>
            To square: e3<br>
            Captured piece should be found at: e4 (not e3)
        </div>
    </div>
    
    <div class="test-case">
        <h3>Test Case 3: Regular capture (should not be affected)</h3>
        <p><strong>Setup:</strong> White pawn captures Black piece normally</p>
        <p><strong>Move:</strong> exd5 (regular capture)</p>
        <p><strong>Expected:</strong> Animation should capture the piece from d5</p>
        <div class="code">
            FEN before move: rnbqkbnr/ppp1pppp/8/3p4/4P3/8/PPPP1PPP/RNBQKBNR w KQkq - 0 3<br>
            From square: e4<br>
            To square: d5<br>
            Captured piece should be found at: d5 (normal behavior)
        </div>
    </div>
    
    <h2>Fix Summary</h2>
    <p>The bug was in the <code>handleCaptureAnimation</code> function in <code>Frontend.scala</code>:</p>
    <ul>
        <li><strong>Problem:</strong> For en-passant captures, the function was looking for the captured piece at the destination square, but in en-passant the captured pawn is on a different square.</li>
        <li><strong>Solution:</strong> Added <code>isEnPassantMove</code> detection and <code>getEnPassantVictimSquare</code> calculation to find the correct square of the captured pawn.</li>
        <li><strong>Impact:</strong> En-passant captures now show the correct capture animation, enhancing the visual feedback for players.</li>
    </ul>
    
    <h2>Technical Details</h2>
    <p>The fix adds three new private functions:</p>
    <ol>
        <li><code>isEnPassantMove</code> - Detects if a move is an en-passant capture by checking if it's a diagonal pawn move to an empty square with a capturable pawn adjacent</li>
        <li><code>getEnPassantVictimSquare</code> - Calculates the square where the captured pawn is located (same file as destination, same rank as origin)</li>
        <li>Updated <code>handleCaptureAnimation</code> - Uses the correct square to find the captured piece for animation</li>
    </ol>
</body>
</html>